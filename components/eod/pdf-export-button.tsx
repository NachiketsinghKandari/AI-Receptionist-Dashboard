'use client';

import { RefObject } from 'react';
import { ChevronDown, Printer } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';

const HELLOCOUNSEL_SVG = `<svg width="140" height="30" viewBox="0 0 184 35" fill="#18181b" xmlns="http://www.w3.org/2000/svg"><path opacity="0.05" d="M27.8012 19.6331L15.0012 32.4331L2.20117 19.6331V15.3664L15.0012 2.56641L27.8012 15.3664V19.6331Z"/><path d="M16.0671 2.56667V6.83333C16.0671 7.11623 15.9547 7.38754 15.7547 7.58758C15.5547 7.78762 15.2834 7.9 15.0005 7.9C14.7176 7.9 14.4462 7.78762 14.2462 7.58758C14.0462 7.38754 13.9338 7.11623 13.9338 6.83333V2.56667C13.9338 2.28377 14.0462 2.01246 14.2462 1.81242C14.4462 1.61238 14.7176 1.5 15.0005 1.5C15.2834 1.5 15.5547 1.61238 15.7547 1.81242C15.9547 2.01246 16.0671 2.28377 16.0671 2.56667ZM21.4005 7.9C21.1176 7.9 20.8462 8.01238 20.6462 8.21242C20.4462 8.41246 20.3338 8.68377 20.3338 8.96667V13.2333C20.3338 13.5162 20.4462 13.7875 20.6462 13.9876C20.8462 14.1876 21.1176 14.3 21.4005 14.3C21.6834 14.3 21.9547 14.1876 22.1547 13.9876C22.3547 13.7875 22.4671 13.5162 22.4671 13.2333V8.96667C22.4671 8.68377 22.3547 8.41246 22.1547 8.21242C21.9547 8.01238 21.6834 7.9 21.4005 7.9ZM15.0005 27.1C14.7176 27.1 14.4462 27.2124 14.2462 27.4124C14.0462 27.6125 13.9338 27.8838 13.9338 28.1667V32.4333C13.9338 32.7162 14.0462 32.9875 14.2462 33.1876C14.4462 33.3876 14.7176 33.5 15.0005 33.5C15.2834 33.5 15.5547 33.3876 15.7547 33.1876C15.9547 32.9875 16.0671 32.7162 16.0671 32.4333V28.1667C16.0671 27.8838 15.9547 27.6125 15.7547 27.4124C15.5547 27.2124 15.2834 27.1 15.0005 27.1ZM15.0005 11.1C14.7176 11.1 14.4462 11.2124 14.2462 11.4124C14.0462 11.6125 13.9338 11.8838 13.9338 12.1667V22.8333C13.9338 23.1162 14.0462 23.3875 14.2462 23.5876C14.4462 23.7876 14.7176 23.9 15.0005 23.9C15.2834 23.9 15.5547 23.7876 15.7547 23.5876C15.9547 23.3875 16.0671 23.1162 16.0671 22.8333V12.1667C16.0671 11.8838 15.9547 11.6125 15.7547 11.4124C15.5547 11.2124 15.2834 11.1 15.0005 11.1ZM8.60045 7.9C8.31756 7.9 8.04625 8.01238 7.84621 8.21242C7.64617 8.41246 7.53379 8.68377 7.53379 8.96667V16.4333C7.53379 16.7162 7.64617 16.9875 7.84621 17.1876C8.04625 17.3876 8.31756 17.5 8.60045 17.5C8.88335 17.5 9.15466 17.3876 9.3547 17.1876C9.55474 16.9875 9.66712 16.7162 9.66712 16.4333V8.96667C9.66712 8.68377 9.55474 8.41246 9.3547 8.21242C9.15466 8.01238 8.88335 7.9 8.60045 7.9ZM21.4005 17.5C21.1176 17.5 20.8462 17.6124 20.6462 17.8124C20.4462 18.0125 20.3338 18.2838 20.3338 18.5667V26.0333C20.3338 26.3162 20.4462 26.5875 20.6462 26.7876C20.8462 26.9876 21.1176 27.1 21.4005 27.1C21.6834 27.1 21.9547 26.9876 22.1547 26.7876C22.3547 26.5875 22.4671 26.3162 22.4671 26.0333V18.5667C22.4671 18.2838 22.3547 18.0125 22.1547 17.8124C21.9547 17.6124 21.6834 17.5 21.4005 17.5ZM2.20046 14.3C1.91756 14.3 1.64625 14.4124 1.44621 14.6124C1.24617 14.8125 1.13379 15.0838 1.13379 15.3667V19.6333C1.13379 19.9162 1.24617 20.1875 1.44621 20.3876C1.64625 20.5876 1.91756 20.7 2.20046 20.7C2.48335 20.7 2.75466 20.5876 2.9547 20.3876C3.15474 20.1875 3.26712 19.9162 3.26712 19.6333V15.3667C3.26712 15.0838 3.15474 14.8125 2.9547 14.6124C2.75466 14.4124 2.48335 14.3 2.20046 14.3ZM8.60045 20.7C8.31756 20.7 8.04625 20.8124 7.84621 21.0124C7.64617 21.2125 7.53379 21.4838 7.53379 21.7667V26.0333C7.53379 26.3162 7.64617 26.5875 7.84621 26.7876C8.04625 26.9876 8.31756 27.1 8.60045 27.1C8.88335 27.1 9.15466 26.9876 9.3547 26.7876C9.55474 26.5875 9.66712 26.3162 9.66712 26.0333V21.7667C9.66712 21.4838 9.55474 21.2125 9.3547 21.0124C9.15466 20.8124 8.88335 20.7 8.60045 20.7ZM27.8005 14.3C27.5176 14.3 27.2462 14.4124 27.0462 14.6124C26.8462 14.8125 26.7338 15.0838 26.7338 15.3667V19.6333C26.7338 19.9162 26.8462 20.1875 27.0462 20.3876C27.2462 20.5876 27.5176 20.7 27.8005 20.7C28.0834 20.7 28.3547 20.5876 28.5547 20.3876C28.7547 20.1875 28.8671 19.9162 28.8671 19.6333V15.3667C28.8671 15.0838 28.7547 14.8125 28.5547 14.6124C28.3547 14.4124 28.0834 14.3 27.8005 14.3Z"/><path d="M179.787 26.2992V8.69922H182.867V26.2992H179.787Z"/><path d="M171.91 26.5434C170.59 26.5434 169.432 26.2664 168.438 25.7123C167.461 25.1583 166.695 24.3923 166.141 23.4146C165.603 22.4368 165.334 21.3123 165.334 20.0412C165.334 18.7701 165.603 17.6538 166.141 16.6923C166.695 15.7146 167.461 14.9568 168.438 14.419C169.416 13.8649 170.557 13.5879 171.861 13.5879C173.099 13.5879 174.175 13.8486 175.087 14.3701C176 14.8753 176.709 15.5923 177.214 16.5212C177.719 17.4501 177.972 18.5338 177.972 19.7723C177.972 20.0005 177.964 20.2123 177.947 20.4079C177.931 20.6034 177.907 20.799 177.874 20.9946H167.241V18.8434H175.503L174.867 19.4301C174.867 18.2568 174.598 17.3768 174.061 16.7901C173.523 16.2034 172.773 15.9101 171.812 15.9101C170.769 15.9101 169.938 16.2686 169.318 16.9857C168.715 17.7027 168.414 18.7375 168.414 20.0901C168.414 21.4264 168.715 22.4531 169.318 23.1701C169.938 23.8709 170.81 24.2212 171.934 24.2212C172.586 24.2212 173.156 24.099 173.645 23.8546C174.134 23.6101 174.493 23.2353 174.721 22.7301H177.63C177.222 23.9034 176.53 24.8323 175.552 25.5168C174.59 26.2012 173.376 26.5434 171.91 26.5434Z"/><path d="M159.058 26.5434C157.331 26.5434 155.954 26.1849 154.927 25.4679C153.9 24.7346 153.338 23.7242 153.24 22.4368H156.051C156.133 23.0723 156.434 23.5531 156.956 23.879C157.477 24.2049 158.178 24.3679 159.058 24.3679C159.857 24.3679 160.451 24.2457 160.842 24.0012C161.25 23.7405 161.454 23.3738 161.454 22.9012C161.454 22.559 161.339 22.282 161.111 22.0701C160.883 21.842 160.451 21.6546 159.816 21.5079L157.811 21.0434C156.442 20.7501 155.424 20.2938 154.756 19.6746C154.104 19.039 153.778 18.2486 153.778 17.3034C153.778 16.1464 154.218 15.242 155.098 14.5901C155.994 13.922 157.225 13.5879 158.789 13.5879C160.337 13.5879 161.576 13.922 162.505 14.5901C163.45 15.242 163.971 16.1464 164.069 17.3034H161.258C161.177 16.7983 160.916 16.4153 160.476 16.1546C160.052 15.8938 159.465 15.7634 158.716 15.7634C158.015 15.7634 157.485 15.8775 157.127 16.1057C156.768 16.3175 156.589 16.6353 156.589 17.059C156.589 17.3849 156.728 17.662 157.005 17.8901C157.282 18.102 157.746 18.2894 158.398 18.4523L160.549 18.9412C161.771 19.2183 162.692 19.699 163.311 20.3834C163.947 21.0679 164.265 21.8746 164.265 22.8034C164.265 23.9931 163.808 24.9138 162.896 25.5657C161.983 26.2175 160.704 26.5434 159.058 26.5434Z"/><path d="M139.86 26.299V13.8323H142.867V16.7657H142.94V26.299H139.86ZM148.611 26.299V18.4279C148.611 17.662 148.416 17.0834 148.025 16.6923C147.634 16.3012 147.063 16.1057 146.314 16.1057C145.662 16.1057 145.075 16.2523 144.554 16.5457C144.048 16.839 143.649 17.2464 143.356 17.7679C143.079 18.2894 142.94 18.8923 142.94 19.5768L142.623 16.5946C143.046 15.682 143.666 14.9568 144.48 14.419C145.295 13.8649 146.273 13.5879 147.414 13.5879C148.766 13.5879 149.817 13.9709 150.567 14.7368C151.333 15.5027 151.716 16.5212 151.716 17.7923V26.299H148.611Z"/><path d="M129.63 26.5431C128.766 26.5431 128.017 26.3639 127.381 26.0054C126.762 25.6306 126.281 25.1254 125.939 24.4898C125.613 23.8543 125.45 23.1372 125.45 22.3387V13.832H128.53V21.7031C128.53 22.4691 128.718 23.0476 129.092 23.4387C129.484 23.8298 130.029 24.0254 130.73 24.0254C131.366 24.0254 131.92 23.8787 132.392 23.5854C132.881 23.292 133.264 22.8846 133.541 22.3631C133.835 21.8254 133.981 21.2224 133.981 20.5543L134.299 23.5365C133.892 24.4491 133.281 25.1824 132.466 25.7365C131.667 26.2743 130.722 26.5431 129.63 26.5431ZM134.079 26.2987V23.3654H133.981V13.832H137.086V26.2987H134.079Z"/><path d="M117.171 26.5434C115.851 26.5434 114.686 26.2664 113.676 25.7123C112.682 25.1583 111.908 24.3923 111.354 23.4146C110.799 22.4205 110.522 21.2879 110.522 20.0168C110.522 18.7457 110.799 17.6294 111.354 16.6679C111.908 15.7064 112.682 14.9568 113.676 14.419C114.686 13.8649 115.851 13.5879 117.171 13.5879C118.508 13.5879 119.673 13.8649 120.667 14.419C121.661 14.9568 122.435 15.7064 122.989 16.6679C123.543 17.6294 123.82 18.7457 123.82 20.0168C123.82 21.2879 123.535 22.4205 122.965 23.4146C122.411 24.3923 121.637 25.1583 120.642 25.7123C119.648 26.2664 118.491 26.5434 117.171 26.5434ZM117.171 24.0746C117.823 24.0746 118.41 23.9116 118.931 23.5857C119.453 23.2434 119.86 22.7709 120.154 22.1679C120.447 21.5486 120.594 20.8234 120.594 19.9923C120.594 18.7701 120.268 17.8086 119.616 17.1079C118.98 16.4072 118.165 16.0568 117.171 16.0568C116.177 16.0568 115.354 16.4072 114.702 17.1079C114.051 17.8086 113.725 18.7701 113.725 19.9923C113.725 20.8234 113.871 21.5486 114.165 22.1679C114.474 22.7709 114.882 23.2434 115.387 23.5857C115.908 23.9116 116.503 24.0746 117.171 24.0746Z"/><path d="M101.695 26.544C100.441 26.544 99.2835 26.324 98.2242 25.884C97.1813 25.4277 96.2687 24.7921 95.4864 23.9773C94.7042 23.1625 94.1013 22.201 93.6776 21.0929C93.2538 19.9847 93.042 18.7706 93.042 17.4506C93.042 16.1306 93.2538 14.9247 93.6776 13.8329C94.1013 12.741 94.6961 11.7958 95.462 10.9973C96.2442 10.1825 97.1568 9.55508 98.1998 9.11508C99.259 8.67508 100.424 8.45508 101.695 8.45508C103.097 8.45508 104.36 8.73212 105.484 9.28619C106.609 9.84026 107.529 10.6225 108.246 11.6329C108.98 12.6269 109.428 13.8003 109.591 15.1529H106.462C106.266 13.8329 105.737 12.8225 104.873 12.1217C104.009 11.4047 102.958 11.0462 101.72 11.0462C100.628 11.0462 99.6746 11.3069 98.8598 11.8284C98.045 12.3499 97.4094 13.0914 96.9531 14.0529C96.4968 14.998 96.2687 16.1225 96.2687 17.4262C96.2687 18.7625 96.4968 19.9195 96.9531 20.8973C97.4094 21.8588 98.0531 22.6084 98.8842 23.1462C99.7153 23.684 100.669 23.9529 101.744 23.9529C102.95 23.9529 103.985 23.6025 104.849 22.9017C105.712 22.1847 106.258 21.1743 106.486 19.8706H109.64C109.444 21.2069 108.98 22.3803 108.246 23.3906C107.529 24.401 106.609 25.1832 105.484 25.7373C104.36 26.2751 103.097 26.544 101.695 26.544Z"/><path d="M85.4891 26.5434C84.2669 26.5434 83.1913 26.2583 82.2624 25.6879C81.3335 25.1175 80.6084 24.3434 80.0869 23.3657C79.5817 22.3716 79.3291 21.2553 79.3291 20.0168C79.3291 18.762 79.5898 17.6538 80.1113 16.6923C80.6328 15.7309 81.3498 14.9731 82.2624 14.419C83.1913 13.8649 84.2669 13.5879 85.4891 13.5879C86.7276 13.5879 87.8032 13.8649 88.7158 14.419C89.6447 14.9731 90.3617 15.7309 90.8669 16.6923C91.3884 17.6538 91.6491 18.762 91.6491 20.0168C91.6491 21.2553 91.3884 22.3716 90.8669 23.3657C90.3617 24.3434 89.6447 25.1175 88.7158 25.6879C87.8032 26.2583 86.7276 26.5434 85.4891 26.5434ZM85.4891 24.8812C86.3365 24.8812 87.0698 24.6775 87.6891 24.2701C88.3084 23.8464 88.7891 23.2679 89.1313 22.5346C89.4735 21.8012 89.6447 20.9538 89.6447 19.9923C89.6447 18.5583 89.2617 17.4094 88.4958 16.5457C87.7461 15.682 86.7439 15.2501 85.4891 15.2501C84.2506 15.2501 83.2484 15.682 82.4824 16.5457C81.7165 17.4094 81.3335 18.5583 81.3335 19.9923C81.3335 20.9538 81.5047 21.8012 81.8469 22.5346C82.1891 23.2679 82.6698 23.8464 83.2891 24.2701C83.9247 24.6775 84.658 24.8812 85.4891 24.8812Z"/><path d="M74.9229 26.2992V8.69922H76.8784V26.2992H74.9229Z"/><path d="M69.54 26.2992V8.69922H71.4956V26.2992H69.54Z"/><path d="M61.3396 26.5434C60.15 26.5434 59.0989 26.2664 58.1863 25.7123C57.2737 25.142 56.5566 24.3679 56.0352 23.3901C55.5137 22.4123 55.2529 21.2879 55.2529 20.0168C55.2529 18.7457 55.5055 17.6294 56.0107 16.6679C56.5322 15.6901 57.2574 14.9323 58.1863 14.3946C59.1152 13.8568 60.1826 13.5879 61.3885 13.5879C62.5455 13.5879 63.5477 13.8405 64.3952 14.3457C65.2589 14.8509 65.9189 15.5597 66.3752 16.4723C66.8477 17.3849 67.084 18.4605 67.084 19.699C67.084 19.862 67.0759 20.0168 67.0596 20.1634C67.0596 20.3101 67.0433 20.4731 67.0107 20.6523H56.7196V19.0146H65.8129L65.1774 19.919C65.1774 18.4197 64.8433 17.2709 64.1752 16.4723C63.5233 15.6575 62.5944 15.2501 61.3885 15.2501C60.15 15.2501 59.1477 15.682 58.3818 16.5457C57.6322 17.3931 57.2574 18.542 57.2574 19.9923C57.2574 21.4753 57.6322 22.6649 58.3818 23.5612C59.1477 24.4412 60.1663 24.8812 61.4374 24.8812C62.2359 24.8812 62.9366 24.7101 63.5396 24.3679C64.1426 24.0094 64.5826 23.5042 64.8596 22.8523H66.7174C66.31 23.9931 65.6255 24.8975 64.664 25.5657C63.7189 26.2175 62.6107 26.5434 61.3396 26.5434Z"/><path d="M38.8672 26.2992V8.69922H40.8716V26.2992H38.8672ZM50.6494 26.2992V8.69922H52.6539V26.2992H50.6494ZM39.8939 16.2526H51.5294V18.0126H39.8939V16.2526Z"/></svg>`;

const BEY_LOGO_URL = 'https://beyandassociates.com/wp-content/uploads/2021/08/bey-logo-300x66.png';

function imageToDataUrl(url: string): Promise<string> {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      canvas.getContext('2d')!.drawImage(img, 0, 0);
      resolve(canvas.toDataURL('image/png'));
    };
    img.onerror = reject;
    img.src = url;
  });
}

type LogoBranding = 'firm' | 'hellocounsel' | 'none';

interface PDFExportButtonProps {
  contentRef: RefObject<HTMLDivElement | null>;
  filename: string;
  reportTitle: string;
  reportDate: string;
  firmId?: number | null;
  firmName?: string | null;
}

export function PDFExportButton({
  contentRef,
  filename,
  reportTitle,
  reportDate,
  firmId,
  firmName,
}: PDFExportButtonProps) {
  const openPrintWindow = (content: string, logoHtml: string) => {
    const printWindow = window.open('', '_blank');
    if (!printWindow) {
      alert('Please allow popups to print the report');
      return;
    }

    const formattedDate = new Date(reportDate + 'T00:00:00').toLocaleDateString(
      'en-US',
      { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }
    );

    const html = `<!DOCTYPE html>
<html>
  <head>
    <title>${filename}</title>
    <style>
      @page {
        margin: 0.6in 0.6in 0.8in 0.6in;
        size: letter;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-size: 12px;
        line-height: 1.6;
        color: #1a1a1a;
        counter-reset: page-number;
      }

      /* ── Header ── */
      .report-header {
        padding-bottom: 16px;
        margin-bottom: 20px;
        border-bottom: 2px solid #18181b;
      }
      .report-header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .report-logo img {
        height: 28px;
        width: auto;
      }
      .report-logo svg {
        height: 28px;
        width: auto;
      }
      .report-title {
        font-size: 22px;
        font-weight: 700;
        color: #18181b;
        margin-top: 6px;
        line-height: 1.2;
      }
      .report-date {
        font-size: 12px;
        color: #52525b;
        margin-top: 4px;
      }

      /* ── Typography ── */
      h1 {
        font-size: 18px;
        font-weight: 700;
        margin-top: 28px;
        margin-bottom: 12px;
        padding-bottom: 6px;
        border-bottom: 2px solid #e4e4e7;
        color: #18181b;
        page-break-after: avoid;
      }
      h2 {
        font-size: 15px;
        font-weight: 600;
        margin-top: 22px;
        margin-bottom: 10px;
        padding-bottom: 4px;
        border-bottom: 1px solid #e4e4e7;
        color: #27272a;
        page-break-after: avoid;
      }
      h3 {
        font-size: 13px;
        font-weight: 600;
        margin-top: 16px;
        margin-bottom: 6px;
        color: #27272a;
        page-break-after: avoid;
      }
      h4 {
        font-size: 12px;
        font-weight: 600;
        margin-top: 12px;
        margin-bottom: 4px;
        color: #3f3f46;
        page-break-after: avoid;
      }
      p {
        margin: 6px 0;
        color: #3f3f46;
      }
      ul, ol {
        margin: 6px 0;
        padding-left: 22px;
      }
      li {
        margin: 3px 0;
        color: #3f3f46;
      }
      strong {
        font-weight: 600;
        color: #18181b;
      }
      em {
        font-style: italic;
      }

      /* ── Tables ── */
      table {
        width: 100%;
        border-collapse: collapse;
        margin: 12px 0;
        font-size: 11px;
        page-break-inside: avoid;
      }
      th, td {
        border: 1px solid #d4d4d8;
        padding: 6px 10px;
        text-align: left;
      }
      th {
        background-color: #f4f4f5;
        font-weight: 600;
        color: #18181b;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }
      tr:nth-child(even) {
        background-color: #fafafa;
      }

      /* ── Code ── */
      code {
        background-color: #f4f4f5;
        padding: 1px 5px;
        border-radius: 3px;
        font-family: 'SF Mono', Monaco, 'Courier New', monospace;
        font-size: 10px;
      }
      pre {
        background-color: #f4f4f5;
        padding: 10px;
        border-radius: 6px;
        overflow-x: auto;
        margin: 10px 0;
        page-break-inside: avoid;
      }
      pre code {
        padding: 0;
        background: none;
      }

      /* ── Misc ── */
      blockquote {
        border-left: 3px solid #a1a1aa;
        padding-left: 14px;
        margin: 10px 0;
        font-style: italic;
        color: #52525b;
        page-break-inside: avoid;
      }
      hr {
        border: none;
        border-top: 1px solid #e4e4e7;
        margin: 20px 0;
      }
      a {
        color: #2563eb;
        text-decoration: underline;
        text-underline-offset: 2px;
      }

      /* ── Print-specific ── */
      @media print {
        h1, h2, h3, h4 { page-break-after: avoid; }
        table, pre, blockquote, ul, ol { page-break-inside: avoid; }
        tr { page-break-inside: avoid; }
        .report-header { page-break-after: avoid; }

        /* Prevent orphaned headings at bottom of page */
        h1, h2, h3, h4 { orphans: 3; widows: 3; }
        p { orphans: 2; widows: 2; }
      }
    </style>
  </head>
  <body>
    <div class="report-header">
      <div class="report-header-top">
        <div class="report-logo">${logoHtml}</div>
      </div>
      <div class="report-title">${reportTitle}</div>
      <div class="report-date">${formattedDate}</div>
    </div>
    ${content}
  </body>
</html>`;

    printWindow.document.open();
    printWindow.document.write(html);
    printWindow.document.close();

    let printed = false;
    const triggerPrint = () => {
      if (printed || printWindow.closed) return;
      printed = true;
      printWindow.print();
    };

    printWindow.onload = triggerPrint;
    // Fallback for browsers where onload doesn't fire reliably
    setTimeout(triggerPrint, 500);
  };

  const getLogoHtml = async (branding: LogoBranding): Promise<string> => {
    if (branding === 'none') return '';
    if (branding === 'hellocounsel') return HELLOCOUNSEL_SVG;

    // Firm logo
    if (firmId === 1) {
      try {
        const dataUrl = await imageToDataUrl(BEY_LOGO_URL);
        return `<img src="${dataUrl}" alt="Bey &amp; Associates" />`;
      } catch {
        return `<img src="${BEY_LOGO_URL}" alt="Bey &amp; Associates" />`;
      }
    }
    // Fallback to HelloCounsel if no firm logo available
    return HELLOCOUNSEL_SVG;
  };

  const handlePrint = async (branding: LogoBranding) => {
    if (!contentRef.current) return;
    const content = contentRef.current.innerHTML;
    const logoHtml = await getLogoHtml(branding);
    openPrintWindow(content, logoHtml);
  };

  const hasFirmLogo = firmId === 1;

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          <Printer className="h-4 w-4 mr-2" />
          Print / Save PDF
          <ChevronDown className="h-3 w-3 ml-1" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        {hasFirmLogo && (
          <DropdownMenuItem onClick={() => handlePrint('firm')}>
            With Firm Logo{firmName ? ` (${firmName})` : ''}
          </DropdownMenuItem>
        )}
        <DropdownMenuItem onClick={() => handlePrint('hellocounsel')}>
          With HelloCounsel Logo
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => handlePrint('none')}>
          Without Logo
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
